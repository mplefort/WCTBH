(window.webpackJsonp=window.webpackJsonp||[]).push([["ugc_photos"],{"./core/frontend/webpack/async_scripts/loaders/ugc_photos.js":function(e,t,o){"use strict";o("./modules/ugc_photos/frontend/desktop_modal.styl");var i=o("./modules/ugc_photos/frontend/main.js");e.exports=i},"./modules/ugc_photos/frontend/UgcPhotosAbstract.js":function(e,t,o){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}();var a=o("./modules/ugc_photos/frontend/tracking_hub_add.js"),l=o("./modules/deal/frontend/FetchHandler.js"),r=o("./modules/ugc_photos/frontend/UgcPhotosModel.js"),s=40,u=function(e){0},d=function(){function e(t,o,i){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.assign(this,{modalSelector:t,inlineSelector:o,gallerySelectors:i}),this.model=new r,this.$modal=document.querySelector(t),this.gallerySelectors=i,document.querySelectorAll("#ugc-photos "+o+" li").forEach(function(e){return e.addEventListener("click",function(e){n.onImageClick(e.currentTarget)})}),this.setupReportModal(),this.$inlineOpenGalleryLink=document.querySelector(i.galleryLink);var a=document.querySelector(i.galleryModal);this.galleryModal={$el:a,$section:a.querySelector(".image-gallery"),$imageList:a.querySelector("ul"),$loader:a.querySelector(".loader"),$closeIcon:a.querySelector(".close-modal")},this.fetchingGallery=!1,this.pagination={},this.currentCount=0,this.galleryFetchHandler=new l({}),this.fetchGalleryImageUrls(0,s,!0),this.HELPFUL_ACTIVE_CLASSES="";var u={body:{merchantId:this.model.get("merchantUuid")},credentials:"include",method:"post"};this.helpfulFetchHandler=new l({successHandlers:this.onHelpfulSuccess.bind(this),errorHandlers:this.onAjaxError.bind(this,"helpful",!1),requestOpts:u,url:this.model.get("helpfulUrl")}),this.reportFetchHandler=new l({successHandlers:this.onReportSuccess.bind(this),errorHandlers:this.onAjaxError.bind(this,"report",!1),requestOpts:u,url:this.model.get("reportUrl")})}return n(e,[{key:"setupReportModal",value:function(){this.reportModal={$textarea:document.querySelector("#ugc-report-photo-modal textarea"),$reasons:document.querySelector("#ugc-report-photo-modal #ugc-photo-report-dropdown")},u()}},{key:"onReportTextareaChange",value:function(){u()}},{key:"onImageClick",value:function(){u()}},{key:"getReportModalReason",value:function(){u()}},{key:"openGalleryViewModal",value:function(){u()}},{key:"changeReportReason",value:function(){u()}},{key:"openReportModal",value:function(){u()}},{key:"onReportSuccess",value:function(){u()}},{key:"onAjaxError",value:function(){u()}},{key:"openNotificationModal",value:function(){u()}},{key:"debounced",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._debounce(e,t,o).bind(this)}},{key:"_debounce",value:function(e,t,o){var i=this,n=void 0;return function(){for(var a=arguments.length,l=Array(a),r=0;r<a;r++)l[r]=arguments[r];var s=i,u=o&&!n;clearTimeout(n),n=setTimeout(function(){n=null,o||e.apply(s,l)},t),u&&e.apply(s,l)}}},{key:"onGalleryScroll",value:function(e){e>=this.galleryModal.$imageList.offsetHeight-this.galleryModal.$imageList.querySelector("li img").offsetHeight&&this.currentCount<this.pagination.count&&this.fetchGalleryImageUrls(this.currentCount)}},{key:"fetchGalleryImageUrls",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.fetchingGallery||!(void 0===this.pagination.count||this.pagination.count>e)||this.model.filterIds())return Promise.resolve();this.fetchingGallery=!0;var n=this.model.get("fetchUrl");this.galleryFetchHandler.url=n+"&limit="+o+"&offset="+e+"&fetchReasons="+i,this.galleryModal.$loader.classList.add("show-loader");var a=function(){t.fetchingGallery=!1,t.currentCount>=t.pagination.count&&t.galleryModal.$loader.classList.add("hide-loader"),t.galleryModal.$loader.classList.remove("show-loader")};return this.galleryFetchHandler.send().then(function(e){return t.onFetchGalleryImageUrlsSuccess(e,i,o)}).then(a).catch(a)}},{key:"onFetchGalleryImageUrlsSuccess",value:function(e,t,o){var i=this;e&&Object.keys(e).length&&(this.currentCount+=o,this.addToImageData(e,o),0===this.pagination.offset?(this.initFillGalleryViewModal(),this.$inlineOpenGalleryLink.addEventListener("click",function(e){return i.openGalleryViewModal(e.target)})):this.appendGalleryViewModal(),t&&this.setReportingReasons(e.reportReasonsHtml))}},{key:"addToImageData",value:function(e){var t=e.pagination,o=void 0===t?{}:t,i=e.imagesByUuid,n=void 0===i?{}:i,a=e.ids,l=void 0===a?[]:a;this.pagination=o,this.model.addImages(n,l)}},{key:"setReportingReasons",value:function(e){var t=Array.isArray(e)?e.join(""):e;this.reportModal.$reasons.insertAdjacentHTML("beforeend",t),this.$modal.querySelector(".report-link").style.display="block";var o=this.model.get("openReportModalOnLoad");o&&(o.reportUuid===this.model.get("otherReasonUuid")&&window.sessionStorage&&(this.reportModal.$textarea.value=window.sessionStorage.getItem("ugcPhotos.reportOtherReasonText"),window.sessionStorage.removeItem("ugcPhotos.reportOtherReasonText"),this.onReportTextareaChange()),this.changeReportReason(o.reportUuid))}},{key:"assignLocation",value:function(e){window.location.assign(e)}},{key:"redirectToLogin",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments[1],o=window.location.origin+window.location.pathname,i=void 0;i="helpful"===e?"helpful=true&imageUuid="+this.$modal.dataset.activeId:"reportPhoto=true&imageUuid="+this.$modal.dataset.activeId+"&reportUuid="+this.getReportModalReason(t),window.location.search?o+=window.location.search+"&":o+="?",o+=i,this.assignLocation(this.model.get("loginUrlBase")+"?return_to="+encodeURIComponent(o))}},{key:"saveTextInLocalStorage",value:function(e){window.sessionStorage&&window.sessionStorage.setItem("ugcPhotos.reportOtherReasonText",e)}},{key:"windowOpen",value:function(e){window.open(e)}},{key:"onReportSubmit",value:function(e){e.preventDefault();var t=this.getReportModalReason(e),o=this.model.get("infringingContent");if(t===o.uuid)return this.windowOpen(window.location.origin+o.url),Promise.resolve();var i=t===this.model.get("otherReasonUuid"),n=i?this.reportModal.$textarea.value:void 0;return this.model.isLoggedIn()?this.reportFetchHandler.send({imageId:this.$modal.dataset.activeId,reasonId:t,reasonText:n}):(i&&this.saveTextInLocalStorage(n),this.redirectToLogin("report",e),Promise.resolve())}},{key:"meetsMinimumTextareaLength",value:function(){return this.reportModal.$textarea.value.replace(/\s/g,"").length>this.model.get("minimumReportTextLength")}},{key:"initFillGalleryViewModal",value:function(){var e=this,t=this.galleryTemplate(this.model.ids());this.galleryModal.$imageList.innerHTML=t,this.galleryModal.$imageList.addEventListener("click",function(t){"img"===t.target.nodeName.toLowerCase()&&e.onImageClick(t.target.parentNode)}),window.Groupon.Utils.lazyLoadImages(this.gallerySelectors.galleryModal+" ul .sleepy-load",{skip_invisible:!0})}},{key:"appendGalleryViewModal",value:function(){var e=this.model.ids().slice(this.currentCount-20);this.galleryModal.$imageList.insertAdjacentHTML("beforeend",this.galleryTemplate(e)),window.Groupon.Utils.lazyLoadImages(this.gallerySelectors.galleryModal+" ul .sleepy-load",{skip_invisible:!0})}},{key:"galleryTemplate",value:function(e){var t=this,o="";return e.forEach(function(e){if(e){var i=t.model.getImageData(e);i&&(o+="<li data-id='"+e+"'><img alt='"+i.alt+"' class='sleepy-load' data-original='"+i.galleryUrl+"'/></li>")}}),o}},{key:"getHelpfulClass",value:function(){return this.HELPFUL_ACTIVE_CLASSES}},{key:"getHelpfulState",value:function(e){return this.model.getImageData(e).helpfulState}},{key:"getHelpfulAction",value:function(e){return"like"===this.model.getImageData(e).helpfulState?"dislike":"like"}},{key:"onHelpfulButtonClick",value:function(e){if(!this.model.isLoggedIn())return this.redirectToLogin("helpful",e),Promise.resolve();var t=this.$modal.dataset.activeId,o=this.model.getImageData(t),i=this.getHelpfulAction(t);return a("UgcPhotosHelpfulClick",{ugc_image_id:t,ugc_image_url:o.url}),this.helpfulFetchHandler.send({action:i,imageId:t})}},{key:"onHelpfulSuccess",value:function(e){var t=e.id,o=this.getHelpfulAction(t);this.setHelpfulState(t,o),this.setHelpfulCount(t,o)}},{key:"setHelpfulState",value:function(e,t){this.model.updateImageData(e,{helpfulState:t})}},{key:"setHelpfulCount",value:function(e,t){var o=this.model.getImageData(e),i=void 0;switch(t){case"like":i=o.helpfulCount+1;break;case"dislike":i=o.helpfulCount-1;break;default:i=o.helpfulCount}return this.model.updateImageData(e,{helpfulCount:i}),i}},{key:"setHelpfulButtonViewState",value:function(e){var t="object"===(void 0===e?"undefined":i(e))?e.id:e;switch(this.getHelpfulState(t)){case"like":return this._setHelpfulButtonView(t);case"dislike":default:return this._setNotHelpfulButtonView(t)}}}]),e}();d.HELPFUL="like",d.NOT_HELPFUL="dislike",e.exports=d},"./modules/ugc_photos/frontend/UgcPhotosDesktop.js":function(e,t,o){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}(),a=function e(t,o,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,o);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,o,i)}if("value"in n)return n.value;var l=n.get;return void 0!==l?l.call(i):void 0};function l(e){if(Array.isArray(e)){for(var t=0,o=Array(e.length);t<e.length;t++)o[t]=e[t];return o}return Array.from(e)}var r=o("./modules/ugc_photos/frontend/UgcPhotosAbstract.js"),s=o("./modules/ugc_photos/frontend/tracking_hub_add.js"),u=o("./modules/ugc_photos/frontend/clean_up_url_after_redirect.js"),d=o("./modules/deal/frontend/get_dimensions.js").getHeight,c=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#ugc-photos-modal",o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".ugc-photos",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=Object.assign({galleryModal:e+" .gallery-view-modal",galleryLink:e+" .open-ugc-gallery-modal"},i),a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o,n));if(a.$helpfulButton=a.$modal.querySelector(".helpful-btn"),a.$helpfulButton.addEventListener("click",function(){var e=a.model.getImageData(a.$modal.dataset.activeId);return e&&window.localStorage&&(window.localStorage.setItem("ugcPhotos.helpfulOrReportPhotoId",a.$modal.dataset.activeId),window.localStorage.setItem("ugcPhotos.helpfulOrReportPhotoData",JSON.stringify(e))),a.onHelpfulButtonClick()}),a.HELPFUL_ACTIVE_CLASSES="c-bg-prim c-txt-white",a.model.get("hasMultipleImages")){var l=a.$modal.querySelector(".controls");a.$backwardControl=l.querySelector(".back"),a.$backwardControl.addEventListener("click",a.onControlsClick.bind(a,"back")),a.$forwardControl=l.querySelector(".forward"),a.$forwardControl.addEventListener("click",a.onControlsClick.bind(a,"forward"))}window.DealEventPipe.on("openUGCPhotosModal",function(e){return a.handleUGCPhotosModalListener(e)}),a.$modal.querySelector(".report-link").addEventListener("click",function(){var e=a.model.getImageData(a.$modal.dataset.activeId);e&&window.localStorage&&(window.localStorage.setItem("ugcPhotos.helpfulOrReportPhotoId",a.$modal.dataset.activeId),window.localStorage.setItem("ugcPhotos.helpfulOrReportPhotoData",JSON.stringify(e))),a.openReportModal()}),a.reportModal.$el.addEventListener("click",a.closeReportModal.bind(a)),a.reportModal.$reasons.addEventListener("change",a.onReportReasonChange.bind(a)),a.reportModal.$el.querySelector("form").addEventListener("submit",a.onReportSubmit.bind(a)),a.reportModal.$el.querySelector(".modal-body").addEventListener("click",function(e){return e.stopPropagation()}),a.setupNotificationModal(),a.galleryModal.$section.addEventListener("scroll",a.debounced(a.onGalleryScroll));var r=a.$modal.querySelector(".single-image img");r.onload=function(){var t=this.naturalHeight,o=this.naturalWidth,i=t/o,n=document.querySelector(e+" .single-view-modal"),a=Math.min(n?n.offsetWidth:1/0,o);r.style.height=i*a+"px"},a.helpfulFetchHandler.setHandlers({successHandlers:[a.setHelpfulButton.bind(a)]}),u(/([?&](helpful|reportPhoto)=true.*)/);var s=a.model.get("openReportModalOnLoad");s&&(a.fillSingleViewModal(s.imageUuid),a.openSingleViewModal(),a.openReportModal());var d=a.model.get("openHelpfulModalOnLoad");return d&&(a.fillSingleViewModal(d.imageUuid),a.openSingleViewModal()),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),n(t,[{key:"setupReportModal",value:function(){var e=document.querySelector("#ugc-report-photo-modal");this.reportModal={$el:e,$reasons:e.querySelector("#ugc-photo-report-dropdown"),$textarea:e.querySelector("textarea"),$form:e.querySelector("form"),$submitButton:e.querySelector("button"),$closeIcon:e.querySelector(".close-modal")},this.reportModal.$textarea.addEventListener("input",this.onReportTextareaChange.bind(this)),this.reportModal.$closeIcon.addEventListener("click",this.closeReportModal.bind(this))}},{key:"setupNotificationModal",value:function(){this.$notificationModal=document.querySelector("#ugc-notification-modal"),this.$notificationModal.querySelector(".close-modal").addEventListener("click",this.closeNotificationModal.bind(this)),this.$notificationModal.addEventListener("click",this.closeNotificationModal.bind(this)),this.$notificationModal.querySelector(".modal-body").addEventListener("click",function(e){return e.stopPropagation()})}},{key:"fillHeader",value:function(e){var t=e.postDate,o=void 0===t?"":t,i=e.username,n=void 0===i?"":i,a=e.userInitials,l=void 0===a?"":a;this.$modal.querySelector(".post-date").textContent=o,this.$modal.querySelector(".name").textContent=n,this.$modal.querySelector(".user-initials").textContent=l}},{key:"fillGallery",value:function(e){var t=e.url,o=e.alt,i=this.$modal.querySelector(".single-image img");i.src="",i.src=t,i.alt=o}},{key:"fillSingleViewModal",value:function(e){var o=this.model.getImageData(e);if(!o&&window.localStorage){o=JSON.parse(window.localStorage.getItem("ugcPhotos.helpfulOrReportPhotoData"));var i=window.localStorage.getItem("ugcPhotos.helpfulOrReportPhotoId");this.model.addImages(function(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}({},i,o),[i])}o&&(window.localStorage&&(window.localStorage.removeItem("ugcPhotos.helpfulOrReportPhotoData"),window.localStorage.removeItem("ugcPhotos.helpfulOrReportPhotoId")),this.$modal.dataset.activeId=e,this.fillGallery(o),this.fillHeader(o),a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setHelpfulState",this).call(this,e,o.helpfulState),this.setHelpfulButton(e))}},{key:"onControlsClick",value:function(e){var t=void 0,o=this.model.getImageIndex(this.$modal.dataset.activeId);if(null!=o){var i=this.model.ids();"back"===e?t=0===o?i.length-1:o-1:"forward"===e&&(t=o===i.length-1?0:o+1),null!=o&&(this.fillSingleViewModal(i[t]),this.clearReportModal(),"forward"===e&&i.length-t<2&&this.fetchGalleryImageUrls(this.currentCount))}}},{key:"onImageClick",value:function(e){var t={};e.querySelector(".view-all-images-overlay")?this.openGalleryViewModal(e):(0===e.classList.length&&(t={keepFilter:!0}),this.fillSingleViewModal(e.dataset.id),this.openSingleViewModal(t))}},{key:"onGalleryScroll",value:function(){a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onGalleryScroll",this).call(this,this.scrollPosition())}},{key:"scrollPosition",value:function(){return this.galleryModal.$section.scrollTop+this.galleryModal.$section.offsetHeight}},{key:"onModalResizer",value:function(e){this.modalResizerListener=this.debounced(e),window.addEventListener("resize",this.modalResizerListener)}},{key:"onModalResizerClose",value:function(){window.removeEventListener("resize",this.modalResizerListener)}},{key:"setSingleViewModalMaxHeight",value:function(){var e=getComputedStyle(this.$modal),t=this.$modal.offsetHeight-parseInt(e.paddingTop)-parseInt(e.paddingBottom);if(!this.singleViewModalHeightOffset){this.singleViewModalHeightOffset=this.$modal.querySelector(".single-view-header").offsetHeight;var o=this.$modal.querySelector(".show-modal > .container-close-modal");o&&(this.singleViewModalHeightOffset=this.singleViewModalHeightOffset+o.offsetHeight)}var i=t-this.singleViewModalHeightOffset;return this.$modal.querySelector(".single-image img").style.maxHeight=i+"px",i}},{key:"_showImageModal",value:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};window.GIG&&window.GIG.Modal&&(this.$modal.querySelector(".single-view-modal").style.display="none",this.$modal.querySelector(".gallery-view-modal").style.display="none",this.$modal.querySelector(e).style.display="block",!0!==o.keepFilter&&this.clearFilterIds(),GIG.Modal.open({el:this.$modal}),GIG.Modal.onClose(this.onModalResizerClose.bind(this),this.$modal.getAttribute("id"),!0),t.call(this),this.onModalResizer(t))}},{key:"clearFilterIds",value:function(){this.model.updateFilterIds(),this.initFillGalleryViewModal()}},{key:"handleUGCPhotosModalListener",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.filterIds,o=e.currentImageId;this.model.backfillMissingPhotoData(e.reviewData),this.model.updateFilterIds(t);var i=this.model.ids();void 0===o&&(o=i[0]),this.fillSingleViewModal(o);this.openSingleViewModal({keepFilter:!0}),this.initFillGalleryViewModal()}},{key:"openSingleViewModal",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._showImageModal(".single-view-modal",this.setSingleViewModalMaxHeight,e),this.clearReportModal(),this._setupLeftRightArrowHandlers()}},{key:"_setupLeftRightArrowHandlers",value:function(){var e=this;this.arrowListeners=function(t){e.reportModal.$el.classList.contains("show-modal")||e.$notificationModal.classList.contains("show-modal")||("ArrowLeft"===t.key?e.onControlsClick("back"):"ArrowRight"===t.key&&e.onControlsClick("forward"))}.bind(this),document.body.addEventListener("keyup",this.arrowListeners),GIG.Modal.onClose(function(){return document.body.removeEventListener("keyup",e.arrowListeners)},this.$modal.getAttribute("id"),!0)}},{key:"getGalleryHeightOffset",value:function(){return d(this.$modal.querySelector(".gallery-view-modal header"))}},{key:"getGalleryViewModalHeight",value:function(){return d(this.$modal.querySelector(".gallery-view-modal"))}},{key:"setGalleryMaxHeight",value:function(){this.galleryViewModalHeightOffset||(this.galleryViewModalHeightOffset=this.getGalleryHeightOffset());var e=this.getGalleryViewModalHeight(),t=this.$modal.querySelectorAll(".gallery-view-modal ul li img ").length;this.galleryModal.$section.style.maxHeight=t>15?e-this.galleryViewModalHeightOffset+"px":"calc(100% - "+this.galleryViewModalHeightOffset+"px)"}},{key:"openGalleryViewModal",value:function(e){var t=void 0;e&&e.classList.contains("open-ugc-gallery-modal")&&(t={keepFilter:!0}),this._showImageModal(".gallery-view-modal",this.setGalleryMaxHeight,t)}},{key:"closeReportModal",value:function(e){e&&e.stopImmediatePropagation(),this.reportModal.$el.classList.remove("show-modal"),this._removeEscKeyHandler()}},{key:"changeReportReason",value:function(e){e&&(this.reportModal.$reasons.value=e,this.onReportReasonChange())}},{key:"_addEscKeyHandler",value:function(e){this.$modal.dataset.closeonesckey=!1,this.escKeyListener=function(t){"Escape"===t.key&&e(t)},document.body.addEventListener("keyup",this.escKeyListener)}},{key:"_removeEscKeyHandler",value:function(){this.$modal.dataset.closeonesckey=!0,document.body.removeEventListener("keyup",this.escKeyListener)}},{key:"openReportModal",value:function(){var e=this.$modal.dataset.activeId,t=this.model.getImageData(e);!t&&window.localStorage&&(t=window.localStorage.getItem("ugcPhotos.reportPhotoData"));s("UgcPhotosReportClick",{ugc_image_id:e,ugc_image_url:t.url}),this.reportModal.$el.classList.add("show-modal"),this._addEscKeyHandler(this.closeReportModal.bind(this))}},{key:"onReportReasonChange",value:function(){var e=this.reportModal.$reasons.value,t=!e.length;e===this.model.get("otherReasonUuid")?(this.reportModal.$textarea.style.display="block",t=!this.meetsMinimumTextareaLength()):this.reportModal.$textarea.style.display="none",this.reportModal.$submitButton[t?"setAttribute":"removeAttribute"]("disabled",!0)}},{key:"clearReportModal",value:function(){this.reportModal.$reasons.value="",this.reportModal.$textarea.value="",this.reportModal.$textarea.style.display="none",this.reportModal.$submitButton.setAttribute("disabled",!0)}},{key:"onReportTextareaChange",value:function(){var e=!this.meetsMinimumTextareaLength();this.reportModal.$submitButton[e?"setAttribute":"removeAttribute"]("disabled",!0)}},{key:"getReportModalReason",value:function(){return this.reportModal.$reasons.value}},{key:"onReportSuccess",value:function(){this.closeReportModal(),this.openNotificationModal("report",!0)}},{key:"onAjaxError",value:function(e,t){"report"===e&&this.closeReportModal(),this.openNotificationModal(e,t)}},{key:"openNotificationModal",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=this.$notificationModal.querySelectorAll(".ugc-notification-header, .ugc-notification-text"),i=0;i<o.length;i++)o[i].style.display="none";this.$notificationModal.querySelector(".ugc-notification-header."+e).style.display="block";var n=t?"success":"error";this.$notificationModal.querySelector(".ugc-notification-text."+n).style.display="block",this.$notificationModal.classList.add("show-modal"),this._addEscKeyHandler(this.closeNotificationModal.bind(this))}},{key:"closeNotificationModal",value:function(e){e.stopImmediatePropagation(),this.$notificationModal.classList.remove("show-modal"),this._removeEscKeyHandler()}},{key:"setHelpfulButton",value:function(e){this.setHelpfulCountText(e),this.setHelpfulButtonViewState(e)}},{key:"setHelpfulCountText",value:function(e){var o="object"===(void 0===e?"undefined":i(e))?e.id:e,n=a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setHelpfulCount",this).call(this,o);this.$helpfulButton.querySelector(".helpful-count").textContent="("+n+")"}},{key:"setHelpfulButtonViewState",value:function(e){a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setHelpfulButtonViewState",this).call(this,e)}},{key:"_setHelpfulButtonView",value:function(){var e;(e=this.$helpfulButton.classList).add.apply(e,l((a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getHelpfulClass",this).call(this)+" "+r.HELPFUL).split(" ")))}},{key:"_setNotHelpfulButtonView",value:function(){var e;(e=this.$helpfulButton.classList).remove.apply(e,l((a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getHelpfulClass",this).call(this)+" "+r.HELPFUL).split(" ")))}}]),t}();e.exports=c},"./modules/ugc_photos/frontend/UgcPhotosModel.js":function(e,t,o){"use strict";var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}return e},n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}();var l=o("./modules/ugc_photos/frontend/container.js").connectState,r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.state=this.getState()}return a(e,[{key:"get",value:function(e){if("state"===e)return this._clone(this.state);var t=this.state[e];switch(t){case Array.isArray(t):case"object"===(void 0===t?"undefined":n(t)):return this._clone(t);default:return t}}},{key:"updateFilterIds",value:function(e){void 0!==e?this.state.filterIds=e:delete this.state.filterIds}},{key:"_clone",value:function(e){return JSON.parse(JSON.stringify(e))}},{key:"addImages",value:function(e,t){this.addImagesByIds(t),this.get("ids").forEach(function(t,o){e[t]&&(e[t].index=o)}),this.addImagesByUuid(e)}},{key:"getImageData",value:function(e){return this.state.imagesByUuid[e]&&this.get("imagesByUuid")[e]}},{key:"getImageUuid",value:function(e){return this.state.ids[e]}},{key:"getImageIndex",value:function(e){return this.ids().indexOf(e)}},{key:"addImagesByUuid",value:function(e){!(arguments.length>1&&void 0!==arguments[1])||arguments[1]?this.setState(function(t){return{imagesByUuid:Object.assign({},t.imagesByUuid,e)}}):this.setState(function(t){return{imagesByUuid:Object.assign({},e,t.imagesByUuid)}})}},{key:"updateImageData",value:function(e,t){var o=Object.assign({},this.getImageData(e),t);this.setState(function(t){return{imagesByUuid:Object.assign({},t.imagesByUuid,function(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}({},""+e,Object.assign({},t.imagesByUuid[""+e],o)))}})}},{key:"addImagesByIds",value:function(e){var t=this,o=e.reduce(function(e,o){var i=t.getImageData(o);return i&&!i.backfilledData?e:e.concat(o)},this.state.ids);this.setState({ids:o})}},{key:"filterIds",value:function(){return this.get("filterIds")}},{key:"ids",value:function(){var e=this.get("filterIds");return void 0!==e&&e.length>0?e:this.get("ids")}},{key:"imagesByUuid",value:function(){var e=this.get("imagesByUuid");return e=this.ids().reduce(function(t,o){return e[o]&&(t[o]=e[o]),t},{}),e}},{key:"isLoggedIn",value:function(){return this.get("isLoggedIn")}},{key:"backfillMissingPhotoData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e.ugcPhotos){var t={};e.ugcPhotos.forEach(function(o){t[o.id]=i({},o,{galleryUrl:o.url+"/v1/sc175x175",backfilledData:!0,reviewId:e.id,reviewText:e.reviewText,rating:e.rating,postDate:e.createdDate,rawPostDate:e.createdDate}),e.user&&(Object.assign(t[o.id],{userInitials:e.user.initials,username:e.user.maskedName}),e.user.stats&&Object.assign(t[o.id],{userRatingCount:e.user.stats.ratingCount,userReviewCount:e.user.stats.ratingCount,userImageCount:e.user.stats.helpfulCount}))}),this.addImagesByUuid(t,!1)}}}]),e}();l("ugcPhotos",r),e.exports=r},"./modules/ugc_photos/frontend/clean_up_url_after_redirect.js":function(e,t,o){"use strict";e.exports=function(e){var t=window.location.href;if(!e.test(t))return null;var o=t.split(e)[0];window.history.pushState?window.history.pushState(null,null,o):document.location.href=o}},"./modules/ugc_photos/frontend/container.js":function(e,t,o){"use strict";var i={},n={setStateFun:function(e,t){return Object.assign(t,e.call(this,t))},setStateProp:function(e,t){return Object.assign(t,e)},getContainer:function(e){return i[e]},getState:function(e){return i[e]?i[e].state:void 0},setState:function(e,t){var o="function"==typeof e?n.setStateFun(e,n.getState(t)):n.setStateProp(e,n.getState(t));n.getContainer(t).state=o},injectContainer:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;i[e]={state:t},o&&(o.container=i[e])},connectState:function(e,t){t.prototype.getState=function(t){return t?n.getState(t):n.getState(e)},t.prototype.setState=function(t,o){o?n.setState(t,o):n.setState(t,e)}}};e.exports=n},"./modules/ugc_photos/frontend/contextmenu.js":function(e,t,o){"use strict";e.exports={disabled:function(e){var t=this;document.querySelectorAll(e).forEach(function(e){e.addEventListener("contextmenu",function(e){"img"===e.target.nodeName.toLowerCase()&&t._prevent(e)})})},_prevent:function(e){return e.stopPropagation(),e.preventDefault(),!1}}},"./modules/ugc_photos/frontend/desktop_modal.styl":function(e,t,o){},"./modules/ugc_photos/frontend/main.js":function(e,t,o){"use strict";var i=o("./modules/ugc_photos/frontend/UgcPhotosDesktop.js"),n=o("./modules/ugc_photos/frontend/contextmenu.js"),a=o("./modules/ugc_photos/frontend/container.js").injectContainer,l={init:function(e,t){var o=e.ugcPhotos;a("ugcPhotos",o,this);new i;return n.disabled("#ugc-photos, #ugc-photos-modal"),t()}};e.exports=l},"./modules/ugc_photos/frontend/tracking_hub_add.js":function(e,t,o){"use strict";e.exports=function(e,t){return OptimizeSuite.TrackingHub.add(e,t)}}}]);
//# sourceMappingURL=ugc_photos-dc6f64d1b9.js.map